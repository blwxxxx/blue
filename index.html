<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∏åÎ£®ÎßàÎ∏î - Blue Marble</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 32px;
        }

        .game-board {
            position: relative;
            width: 100%;
            max-width: 700px;
            aspect-ratio: 1;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            gap: 0;
            padding: 10px;
        }

        .cell {
            background: white;
            border: 2px solid #764ba2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            padding: 3px;
            position: relative;
            transition: all 0.3s;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .cell:hover {
            transform: translateY(-3px);
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
        }

        .cell.corner {
            font-weight: bold;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }

        .cell.city {
            cursor: pointer;
        }

        .cell-name {
            font-weight: bold;
            text-align: center;
            margin-bottom: 2px;
        }

        .cell-price {
            font-size: 8px;
            color: #666;
        }

        .cell-owner {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .building-indicator {
            display: flex;
            gap: 2px;
            margin-top: 2px;
        }

        .building {
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 2px;
        }

        .hotel {
            width: 10px;
            height: 10px;
            background: gold;
            border-radius: 2px;
        }

        .players {
            position: absolute;
            bottom: 2px;
            left: 2px;
            display: flex;
            gap: 2px;
        }

        .player-piece {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .center-area {
            grid-column: 2 / 11;
            grid-row: 2 / 11;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-title {
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .dice-container {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .dice {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        .roll-button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .roll-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }

        .roll-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .player-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .player-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .player-card.active {
            border: 3px solid #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .player-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .player-name {
            font-weight: bold;
            font-size: 16px;
        }

        .player-money {
            color: #27ae60;
            font-weight: bold;
            font-size: 18px;
        }

        .player-properties {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .log-container {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .modal-button {
            padding: 10px 30px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-buy {
            background: #27ae60;
            color: white;
        }

        .btn-pass {
            background: #95a5a6;
            color: white;
        }

        .btn-build {
            background: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üåç Î∏åÎ£®ÎßàÎ∏î (Blue Marble)</h1>
        
        <div class="game-board" id="gameBoard">
            <div class="center-area">
                <div class="game-title">BLUE<br>MARBLE</div>
                <div class="dice-container">
                    <div class="dice" id="dice1">6</div>
                    <div class="dice" id="dice2">6</div>
                </div>
                <button class="roll-button" id="rollButton">Ï£ºÏÇ¨ÏúÑ Íµ¥Î¶¨Í∏∞</button>
                <div id="currentTurn" style="margin-top: 15px; font-size: 16px; font-weight: bold; color: white;">ÌÑ¥: ÎÇò</div>
            </div>
        </div>

        <div class="player-info" id="playerInfo"></div>
        
        <div class="log-container" id="logContainer"></div>
    </div>

    <div class="modal" id="actionModal">
        <div class="modal-content">
            <h2 id="modalTitle">ÎèÑÏãú Íµ¨Îß§</h2>
            <p id="modalText"></p>
            <div class="modal-buttons" id="modalButtons"></div>
        </div>
    </div>

    <script>
        const cities = [
            'Ï∂úÎ∞ú', 'ÌÉÄÏù¥Î≤†Ïù¥', 'Î≤†Ïù¥Ïßï', 'ÎßàÎãêÎùº', 'Ï†úÏ£ºÎèÑ', 'Ïã±Í∞ÄÌè¨Î•¥', 'Ïπ¥Ïù¥Î°ú', 'Î¨¥Ïù∏ÎèÑ',
            'Ïù¥Ïä§ÌÉÑÎ∂à', 'ÏïÑÌÖåÎÑ§', 'ÏΩîÌéúÌïòÍ≤ê', 'Ïä§ÌÜ°ÌôÄÎ¶Ñ', 'Î≤†Î•∏', 'Î≤†Î•ºÎ¶∞', 'Ïò§ÌÉÄÏôÄ', 'ÎπÑÌñâÍ∏∞',
            'Î∂ÄÏóêÎÖ∏Ïä§', 'ÏÉÅÌååÏö∏Î°ú', 'ÏãúÎìúÎãà', 'ÌïòÏôÄÏù¥', 'Îü∞Îçò', 'ÌååÎ¶¨', 'Î°úÎßà', 'ÏõîÍ∏â',
            'Îâ¥Ïöï', 'ÎèÑÏøÑ', 'ÏÑúÏö∏', 'Î™®Ïä§ÌÅ¨Î∞î', 'ÎëêÎ∞îÏù¥', 'Ï†úÎÑ§Î∞î', 'Î≠ÑÎ∞îÏù¥', 'Ï∂úÎ∞ú'
        ];

        const cityPrices = {
            'ÌÉÄÏù¥Î≤†Ïù¥': 50000, 'Î≤†Ïù¥Ïßï': 80000, 'ÎßàÎãêÎùº': 50000, 'Ï†úÏ£ºÎèÑ': 100000,
            'Ïã±Í∞ÄÌè¨Î•¥': 100000, 'Ïπ¥Ïù¥Î°ú': 100000, 'Ïù¥Ïä§ÌÉÑÎ∂à': 150000, 'ÏïÑÌÖåÎÑ§': 150000,
            'ÏΩîÌéúÌïòÍ≤ê': 200000, 'Ïä§ÌÜ°ÌôÄÎ¶Ñ': 200000, 'Î≤†Î•∏': 200000, 'Î≤†Î•ºÎ¶∞': 200000,
            'Ïò§ÌÉÄÏôÄ': 250000, 'Î∂ÄÏóêÎÖ∏Ïä§': 250000, 'ÏÉÅÌååÏö∏Î°ú': 300000, 'ÏãúÎìúÎãà': 300000,
            'ÌïòÏôÄÏù¥': 350000, 'Îü∞Îçò': 350000, 'ÌååÎ¶¨': 500000, 'Î°úÎßà': 500000,
            'Îâ¥Ïöï': 800000, 'ÎèÑÏøÑ': 1000000, 'ÏÑúÏö∏': 1000000, 'Î™®Ïä§ÌÅ¨Î∞î': 800000,
            'ÎëêÎ∞îÏù¥': 600000, 'Ï†úÎÑ§Î∞î': 600000, 'Î≠ÑÎ∞îÏù¥': 400000
        };

        const playerColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12'];
        const playerNames = ['ÎÇò', 'CPU 1', 'CPU 2', 'CPU 3'];

        let gameState = {
            players: [],
            currentPlayer: 0,
            isRolling: false,
            islandTurns: {}
        };

        function initGame() {
            gameState.players = playerNames.map((name, i) => ({
                name,
                color: playerColors[i],
                money: 3000000,
                position: 0,
                properties: [],
                isAI: i > 0,
                isOnIsland: false
            }));

            createBoard();
            updatePlayerInfo();
            addLog('Í≤åÏûÑ ÏãúÏûë! Ï∂úÎ∞ú ÏßÄÏ†êÏóêÏÑú ÏãúÏûëÌï©ÎãàÎã§.');
        }

        function createBoard() {
            const board = document.getElementById('gameBoard');
            const boardCells = [];
            
            // ÌïòÎã® (0-7)
            for (let i = 0; i <= 7; i++) {
                boardCells.push({ pos: i, row: 11, col: i + 1 });
            }
            
            // Ïö∞Ï∏° (8-14)
            for (let i = 1; i <= 7; i++) {
                boardCells.push({ pos: 7 + i, row: 11 - i, col: 9 });
            }
            
            // ÏÉÅÎã® (15-22)
            for (let i = 1; i <= 8; i++) {
                boardCells.push({ pos: 14 + i, row: 4, col: 9 - i });
            }
            
            // Ï¢åÏ∏° (23-30)
            for (let i = 1; i <= 8; i++) {
                boardCells.push({ pos: 22 + i, row: 4 + i, col: 1 });
            }

            boardCells.forEach(cell => {
                const cellDiv = document.createElement('div');
                cellDiv.className = 'cell';
                cellDiv.style.gridRow = cell.row;
                cellDiv.style.gridColumn = cell.col;
                cellDiv.dataset.position = cell.pos;
                
                const cityName = cities[cell.pos];
                
                if (cityName === 'Ï∂úÎ∞ú' || cityName === 'Î¨¥Ïù∏ÎèÑ' || cityName === 'ÎπÑÌñâÍ∏∞' || cityName === 'ÏõîÍ∏â') {
                    cellDiv.classList.add('corner');
                } else if (cityPrices[cityName]) {
                    cellDiv.classList.add('city');
                }
                
                cellDiv.innerHTML = `
                    <div class="cell-name">${cityName}</div>
                    ${cityPrices[cityName] ? `<div class="cell-price">${(cityPrices[cityName]/10000).toFixed(0)}Îßå</div>` : ''}
                    <div class="building-indicator" data-buildings=""></div>
                    <div class="players"></div>
                `;
                
                board.appendChild(cellDiv);
            });

            updatePlayerPositions();
        }

        function updatePlayerPositions() {
            document.querySelectorAll('.players').forEach(el => el.innerHTML = '');
            
            gameState.players.forEach((player, i) => {
                const cell = document.querySelector(`[data-position="${player.position}"]`);
                if (cell) {
                    const playerPiece = document.createElement('div');
                    playerPiece.className = 'player-piece';
                    playerPiece.style.background = player.color;
                    cell.querySelector('.players').appendChild(playerPiece);
                }
            });
        }

        function updatePlayerInfo() {
            const container = document.getElementById('playerInfo');
            container.innerHTML = gameState.players.map((player, i) => `
                <div class="player-card ${i === gameState.currentPlayer ? 'active' : ''}">
                    <div class="player-header">
                        <div class="player-color" style="background: ${player.color}"></div>
                        <div class="player-name">${player.name}</div>
                    </div>
                    <div class="player-money">üí∞ ${player.money.toLocaleString()}Ïõê</div>
                    <div class="player-properties">Î≥¥Ïú† ÎèÑÏãú: ${player.properties.length}Í∞ú</div>
                    ${player.isOnIsland ? '<div style="color: red; font-weight: bold;">üèùÔ∏è Î¨¥Ïù∏ÎèÑ</div>' : ''}
                </div>
            `).join('');
        }

        function rollDice() {
            if (gameState.isRolling) return;
            
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            if (currentPlayer.isOnIsland) {
                const turns = gameState.islandTurns[gameState.currentPlayer] || 0;
                if (turns < 3) {
                    gameState.islandTurns[gameState.currentPlayer] = turns + 1;
                    addLog(`${currentPlayer.name}ÏùÄ(Îäî) Î¨¥Ïù∏ÎèÑÏóêÏÑú ${turns + 1}ÌÑ¥Ïß∏ ÎåÄÍ∏∞ Ï§ë...`);
                    if (turns + 1 >= 3) {
                        currentPlayer.isOnIsland = false;
                        delete gameState.islandTurns[gameState.currentPlayer];
                        addLog(`${currentPlayer.name}Ïù¥(Í∞Ä) Î¨¥Ïù∏ÎèÑÏóêÏÑú ÌÉàÏ∂úÌñàÏäµÎãàÎã§!`);
                    }
                    nextTurn();
                    return;
                }
            }
            
            gameState.isRolling = true;
            document.getElementById('rollButton').disabled = true;
            
            const dice1El = document.getElementById('dice1');
            const dice2El = document.getElementById('dice2');
            
            dice1El.classList.add('rolling');
            dice2El.classList.add('rolling');
            
            setTimeout(() => {
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                dice1El.textContent = dice1;
                dice2El.textContent = dice2;
                dice1El.classList.remove('rolling');
                dice2El.classList.remove('rolling');
                
                addLog(`${currentPlayer.name}Ïù¥(Í∞Ä) ${dice1} + ${dice2} = ${total}ÏùÑ(Î•º)Íµ¥Î†∏ÏäµÎãàÎã§.`);
                
                movePlayer(total);
            }, 500);
        }

        function movePlayer(steps) {
            const player = gameState.players[gameState.currentPlayer];
            const oldPos = player.position;
            player.position = (player.position + steps) % 32;
            
            if (player.position < oldPos) {
                player.money += 200000;
                addLog(`${player.name}Ïù¥(Í∞Ä) Ï∂úÎ∞úÏ†êÏùÑ ÏßÄÎÇò ÏõîÍ∏â 20ÎßåÏõêÏùÑ Î∞õÏïòÏäµÎãàÎã§!`);
            }
            
            updatePlayerPositions();
            
            setTimeout(() => {
                handleLanding();
            }, 500);
        }

        function handleLanding() {
            const player = gameState.players[gameState.currentPlayer];
            const cityName = cities[player.position];
            
            if (cityName === 'Î¨¥Ïù∏ÎèÑ') {
                player.isOnIsland = true;
                gameState.islandTurns[gameState.currentPlayer] = 0;
                addLog(`${player.name}Ïù¥(Í∞Ä) Î¨¥Ïù∏ÎèÑÏóê Í∞áÌòîÏäµÎãàÎã§! 3ÌÑ¥ ÎåÄÍ∏∞...`);
                updatePlayerInfo();
                nextTurn();
                return;
            }
            
            if (cityName === 'ÎπÑÌñâÍ∏∞') {
                const randomPos = Math.floor(Math.random() * 32);
                player.position = randomPos;
                addLog(`${player.name}Ïù¥(Í∞Ä) ÎπÑÌñâÍ∏∞Î•º ÌÉÄÍ≥† ${cities[randomPos]}(Ïúº)Î°ú Ïù¥ÎèôÌñàÏäµÎãàÎã§!`);
                updatePlayerPositions();
                setTimeout(() => handleLanding(), 1000);
                return;
            }
            
            if (cityName === 'ÏõîÍ∏â') {
                player.money += 200000;
                addLog(`${player.name}Ïù¥(Í∞Ä) Î≥¥ÎÑàÏä§ ÏõîÍ∏â 20ÎßåÏõêÏùÑ Î∞õÏïòÏäµÎãàÎã§!`);
                nextTurn();
                return;
            }
            
            if (cityPrices[cityName]) {
                const owner = gameState.players.find(p => p.properties.some(prop => prop.name === cityName));
                
                if (!owner) {
                    if (player.isAI) {
                        setTimeout(() => handleAIDecision(cityName), 1000);
                    } else {
                        showBuyModal(cityName);
                    }
                } else if (owner !== player) {
                    const rent = calculateRent(cityName, owner);
                    player.money -= rent;
                    owner.money += rent;
                    addLog(`${player.name}Ïù¥(Í∞Ä) ${owner.name}ÏóêÍ≤å ÌÜµÌñâÎ£å ${rent.toLocaleString()}ÏõêÏùÑ ÏßÄÎ∂àÌñàÏäµÎãàÎã§.`);
                    updatePlayerInfo();
                    nextTurn();
                } else {
                    if (player.isAI) {
                        setTimeout(() => handleAIBuildDecision(cityName), 1000);
                    } else {
                        showBuildModal(cityName);
                    }
                }
            } else {
                nextTurn();
            }
        }

        function calculateRent(cityName, owner) {
            const prop = owner.properties.find(p => p.name === cityName);
            const baseRent = cityPrices[cityName] * 0.1;
            const buildingBonus = prop.buildings * baseRent * 0.5;
            return Math.floor(baseRent + buildingBonus);
        }

        function showBuyModal(cityName) {
            const modal = document.getElementById('actionModal');
            const price = cityPrices[cityName];
            
            document.getElementById('modalTitle').textContent = `${cityName} Íµ¨Îß§`;
            document.getElementById('modalText').textContent = `Í∞ÄÍ≤©: ${price.toLocaleString()}Ïõê`;
            document.getElementById('modalButtons').innerHTML = `
                <button class="modal-button btn-buy" onclick="buyCity('${cityName}')">Íµ¨Îß§</button>
                <button class="modal-button btn-pass" onclick="closeModal()">Ìè¨Í∏∞</button>
            `;
            
            modal.classList.add('active');
        }

        function showBuildModal(cityName) {
            const modal = document.getElementById('actionModal');
            const buildPrice = cityPrices[cityName] * 0.3;
            
            document.getElementById('modalTitle').textContent = `${cityName} Í±¥Î¨º ÏßìÍ∏∞`;
            document.getElementById('modalText').textContent = `Í±¥Î¨º Í∞ÄÍ≤©: ${buildPrice.toLocaleString()}Ïõê`;
            document.getElementById('modalButtons').innerHTML = `
                <button class="modal-button btn-build" onclick="buildOnCity('${cityName}')">Í±¥ÏÑ§</button>
                <button class="modal-button btn-pass" onclick="closeModal()">Îã§ÏùåÏóê</button>
            `;
            
            modal.classList.add('active');
        }

        function buyCity(cityName) {
            const player = gameState.players[gameState.currentPlayer];
            const price = cityPrices[cityName];
            
            if (player.money >= price) {
                player.money -= price;
                player.properties.push({ name: cityName, buildings: 0 });
                addLog(`${player.name}Ïù¥(Í∞Ä) ${cityName}ÏùÑ(Î•º) ${price.toLocaleString()}ÏõêÏóê Íµ¨Îß§ÌñàÏäµÎãàÎã§!`);
                updateCityOwner(cityName, player);
                updatePlayerInfo();
            }
            
            closeModal();
            nextTurn();
        }

        function buildOnCity(cityName) {
            const player = gameState.players[gameState.currentPlayer];
            const prop = player.properties.find(p => p.name === cityName);
            const buildPrice = Math.floor(cityPrices[cityName] * 0.3);
            
            if (prop && prop.buildings < 3 && player.money >= buildPrice) {
                player.money -= buildPrice;
                prop.buildings++;
                addLog(`${player.name}Ïù¥(Í∞Ä) ${cityName}Ïóê Í±¥Î¨ºÏùÑ ÏßÄÏóàÏäµÎãàÎã§! (${prop.buildings}/3)`);
                updateBuildingDisplay(cityName, prop.buildings);
                updatePlayerInfo();
            }
            
            closeModal();
            nextTurn();
        }

        function updateCityOwner(cityName, player) {
            const cell = Array.from(document.querySelectorAll('.cell')).find(c => 
                c.querySelector('.cell-name').textContent === cityName
            );
            if (cell) {
                let owner = cell.querySelector('.cell-owner');
                if (!owner) {
                    owner = document.createElement('div');
                    owner.className = 'cell-owner';
                    cell.appendChild(owner);
                }
                owner.style.background = player.color;
            }
        }

        function updateBuildingDisplay(cityName, count) {
            const cell = Array.from(document.querySelectorAll('.cell')).find(c => 
                c.querySelector('.cell-name').textContent === cityName
            );
            if (cell) {
                const indicator = cell.querySelector('.building-indicator');
                indicator.innerHTML = '';
                for (let i = 0; i < count; i++) {
                    const building = document.createElement('div');
                    building.className = i === 2 ? 'hotel' : 'building';
                    indicator.appendChild(building);
                }
            }
        }

        function handleAIDecision(cityName) {
            const player = gameState.players[gameState.currentPlayer];
            const price = cityPrices[cityName];
            
            if (player.money >= price && Math.random() > 0.3) {
                buyCity(cityName);
            } else {
                addLog(`${player.name}Ïù¥(Í∞Ä) ${cityName} Íµ¨Îß§Î•º Ìè¨Í∏∞ÌñàÏäµÎãàÎã§.`);
                nextTurn();
            }
        }

        function handleAIBuildDecision(cityName) {
            const player = gameState.players[gameState.currentPlayer];
            const prop = player.properties.find(p => p.name === cityName);
            const buildPrice = Math.floor(cityPrices[cityName] * 0.3);
            
            if (prop && prop.buildings < 3 && player.money >= buildPrice * 2 && Math.random() > 0.4) {
                buildOnCity(cityName);
            } else {
                nextTurn();
            }
        }

        function closeModal() {
            document.getElementById('actionModal').classList.remove('active');
        }

        function nextTurn() {
            gameState.isRolling = false;
            gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;
            document.getElementById('rollButton').disabled = false;
            
            const currentPlayer = gameState.players[gameState.currentPlayer];
            document.getElementById('currentTurn').textContent = `ÌÑ¥: ${currentPlayer.name}`;
            updatePlayerInfo();
            
            if (currentPlayer.isAI) {
                setTimeout(() => rollDice(), 1500);
            }
        }

        function addLog(message) {
            const log = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.insertBefore(entry, log.firstChild);
            
            if (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        document.getElementById('rollButton').addEventListener('click', rollDice);

        initGame();
    </script>
</body>
</html>
